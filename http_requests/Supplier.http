// **** Supplier API Tests (Admin Only) ****
// Set your baseUrl in WebStorm's REST Client environment variables
// Example: baseUrl = http://localhost:3000/api

@authToken=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY5MTU2MjIyMmJiNjAxNzk5OTgwMGMxNyIsImVtYWlsIjoiQXltYW5BbGhhaWtnQGdtYWlsLmNvbSIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc2MzE2NzUzOSwiZXhwIjoxNzYzMzgzNTM5fQ.PiL62PHooumRE4ugJ6CfO3Mcx__nNuqC7Daedo1c43M
@supplierId=6917ebe24d55c6b07a52eac8
### @name createSupplier
# @docs Create Supplier - Success
POST {{baseUrl}}/suppliers
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Test Supplier",
  "website": "https://test-supplier.com"
}

> {%
  client.test("Create supplier - success", function() {
    client.assert(response.status === 201, "Status should be 201");
    client.global.set("supplierId", response.body._id);
  });
%}

### @name createSupplierDuplicate
# @docs Create Supplier - Duplicate Name (Should return 409 Conflict)
POST {{baseUrl}}/suppliers
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Test Supplier",
  "website": "https://another-website.com"
}

> {%
  client.test("Create supplier - duplicate name", function() {
    client.assert(response.status === 409, "Status should be 409 Conflict");
  });
%}

### @name createSupplierInvalid
# @docs Create Supplier - Invalid Data (Should return 400 Bad Request)
POST {{baseUrl}}/suppliers
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "ab",
  "website": "not-a-valid-url"
}

> {%
  client.test("Create supplier - invalid data", function() {
    client.assert(response.status === 400, "Status should be 400 Bad Request");
  });
%}

### @name createSupplierNoWebsite
# @docs Create Supplier - No Website (Optional Field)
POST {{baseUrl}}/suppliers
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Supplier Without Website"
}

> {%
  client.test("Create supplier - no website", function() {
    client.assert(response.status === 201, "Status should be 201");
    client.global.set("supplierNoWebsiteId", response.body._id);
  });
%}

### @name getAllSuppliers
# @docs Get All Suppliers - Admin Only
GET {{baseUrl}}/suppliers
Authorization: Bearer {{authToken}}

> {%
  client.test("Get all suppliers", function() {
    client.assert(response.status === 200, "Status should be 200");
    client.assert(Array.isArray(response.body), "Response should be an array");
  });
%}

### @name getSupplierById
# @docs Get Single Supplier - Admin Only
GET {{baseUrl}}/suppliers/{{supplierId}}
Authorization: Bearer {{authToken}}

> {%
  client.test("Get supplier by ID - success", function() {
    client.assert(response.status === 200, "Status should be 200");
    client.assert(response.body._id === client.global.get("supplierId"), "ID should match");
  });
%}

### @name getSupplierNotFound
# @docs Get Single Supplier - Not Found (Should return 404)
GET {{baseUrl}}/suppliers/507f1f77bcf86cd799439011
Authorization: Bearer {{authToken}}

> {%
  client.test("Get supplier - not found", function() {
    client.assert(response.status === 404, "Status should be 404 Not Found");
  });
%}

### @name updateSupplier
# @docs Update Supplier - Success
PATCH {{baseUrl}}/suppliers/{{supplierId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "website": "https://updated-supplier.com"
}

> {%
  client.test("Update supplier - success", function() {
    client.assert(response.status === 200, "Status should be 200");
    client.assert(response.body.website === "https://updated-supplier.com", "Website should be updated");
  });
%}

### @name updateSupplierDuplicate
# @docs Update Supplier - Duplicate Name (Should return 409 Conflict)
# First create another supplier to test duplicate
POST {{baseUrl}}/suppliers
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Another Supplier",
  "website": "https://another-supplier.com"
}

> {%
  client.test("Pre-create supplier for duplicate test", function() {
    client.global.set("anotherSupplierId", response.body._id);
  });
%}
###
PATCH {{baseUrl}}/suppliers/{{supplierId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Another Supplier"
}

> {%
 client.test("Update supplier - duplicate name", function() {
   client.assert(response.status === 409, "Status should be 409 Conflict");
 });
%}

### @name updateSupplierOnlyName
# @docs Update Supplier - Only Name
PATCH {{baseUrl}}/suppliers/{{supplierId}}
Content-Type: application/json
Authorization: Bearer {{authToken}}

{
  "name": "Updated Supplier Name"
}

> {%
  client.test("Update supplier - only name", function() {
    client.assert(response.status === 200, "Status should be 200");
    client.assert(response.body.name === "Updated Supplier Name", "Name should be updated");
  });
%}

### @name deleteSupplier
# @docs Delete Supplier - Success
DELETE {{baseUrl}}/suppliers/{{supplierId}}
Authorization: Bearer {{authToken}}

> {%
  client.test("Delete supplier - success", function() {
    client.assert(response.status === 204, "Status should be 204 No Content");
  });
%}

### @name deleteSupplierNotFound
# @docs Delete Supplier - Not Found (Should return 404)
DELETE {{baseUrl}}/suppliers/507f1f77bcf86cd799439011
Authorization: Bearer {{authToken}}

> {%
  client.test("Delete supplier - not found", function() {
    client.assert(response.status === 404, "Status should be 404 Not Found");
  });
%}

### @name cleanup
# @docs Cleanup - Delete test data
DELETE {{baseUrl}}/suppliers/{{supplierNoWebsiteId}}
Authorization: Bearer {{authToken}}

> {%
  client.test("Cleanup first test data", function() {
    client.assert(response.status === 204, "Cleanup should succeed");
  });
%}
###
DELETE {{baseUrl}}/suppliers/{{anotherSupplierId}}
Authorization: Bearer {{authToken}}

> {%
 client.test("Cleanup second test data", function() {
   client.assert(response.status === 204, "Cleanup should succeed");
 });
%}

### @name unauthorizedAccess
# @docs Unauthorized Access (Should return 401/403)
GET {{baseUrl}}/suppliers
// No Authorization header

> {%
  client.test("Unauthorized access", function() {
    client.assert(response.status === 401 || response.status === 403, "Status should be 401 or 403");
  });
%}